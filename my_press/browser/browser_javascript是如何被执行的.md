---
title: 从输入URL到页面展示，这中间发生了什么？
category: 浏览器
tag:
  - 浏览器
  - 编译器和解释器
comment: false
---
# 编译器和解释器
之所以存在编译器和解释器，是因为机器不能直接理解我们所写的代码，所以在执行程序之前，需要将我们所写的代码“翻译”成机器能读懂的机器语言。按语言的执行流程，可以把语言划分为编译型语言和解释型语言。

**编译型语言在程序执行之前，需要经过编译器的编译过程，并且编译之后会直接保留机器能读懂的二进制文件，这样每次运行程序时，都可以直接运行该二进制文件，而不需要再次重新编译了。**

**而由解释型语言编写的程序，在每次运行时都需要通过解释器对程序进行动态解释和执行。**

javascript执行流程如下：
- 词法分析
- 语法分析
- 生成抽象语法树
- 基于抽象语法树生成字节码
- 根据字节码来执行程序

# V8如何执行javascript
## 1. 生成抽象语法树和执行上下文
同基本执行流程一样，我们需要将javascript通过词法分析、语法分析生成解释器、编译器能够理解的结构。

抽象语法树是类似于javascript中对象的一种结构。

### 词法分析
词法分析主要是将我们的语句拆分成token，所谓 **token**，指的是语法上不可能再分的、最小的单个字符或字符串。
```javascript
let a = 'test';

// token keyword let
// token identifier a
// token assignment = 
// token literal test
```

### 语法分析
将词法分析得到的token根据语法规则合并为AST，若合并过程中遇到语法不符合规则，则抛出语法错误。

### 生成执行上下文

## 2. 生成字节码
这一步主要是通过解释器将AST转换为字节码

**机器码的执行效率高为什么不直接转换成机器码呢？**
因为辑器码和字节码相比，同一行代码机器码占用的内存大一些，在移动设备上明显会存在一些性能上的问题。

## 3. 执行代码
但我们第一次执行代码时，转换成的字节码会被解释器逐条解释执行，同时在执行过程中解释器会记录**热点代码**（一段代码被多次执行），如果遇到热点代码则会通过**编译器**直接编译成机器码，提高代码的执行效率。

以上的方案被称为**即时编译（JIT）**，完整流程是：解释器 Ignition 在解释执行字节码的同时，收集代码信息，当它发现某一部分代码变热了之后，TurboFan 编译器便闪亮登场，把热点的字节码转换为机器码，并把转换后的机器码保存起来，以备下次使用

# javascript优化
通过以上知识点的了解，我们可以针对性的对javascript优化。
1. 提升单次脚本的执行速度，避免 JavaScript 的长任务霸占主线程，这样可以使得页面快速响应交互；
2. 避免大的内联脚本，因为在解析 HTML 的过程中，解析和编译也会占用主线程；
3. 减少 JavaScript 文件的容量，因为更小的文件会提升下载速度，并且占用更低的内存。