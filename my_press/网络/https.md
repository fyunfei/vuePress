---
title: HTTPS
category: 网络
tag:
  - 对称加密
  - 非对称加密
comment: false
---

# HTTPS
我们都知道引入HTTP协议的目的是为了进行超文本内容的传输，但是这个传输的过程都是以明文的方式传输的，所以可能会存在在传输过程中内容被篡改的情况，所以需要考虑如何安全的对内容进行接收、传输，因此提出了加密方案HTTPS协议。

## HTTP协议栈中引入安全层
HTTPS 并非是一个新的协议，通常 HTTP 直接和 TCP 通信，HTTPS 则先和安全层通信，然后安全层再和 TCP 层通信。也就是说 HTTPS 所有的安全核心都在安全层，它不会影响到上面的 HTTP 协议，也不会影响到下面的 TCP/IP。

## HTTPS的迭代版本

### 1. 对称加密版本
所谓对称加密，就是使用同一个密钥对内容加密和解密。

#### 加密过程
- 需要协商两边的加密解密方式，浏览器会向服务器发送支持的加密方法和一个随机数client-random
- 服务端从客户端发送过来的加密方案列表中选择一个加密方案，并返回给浏览器一个service-random
- 浏览器和客户端拥有相同的client-random和service-random，根据这两种随机数通过指定的方法生成master-secret进行内容的加密和解密

#### 对称加密缺点
client-random和service-random在传输过程中也是以明文的方式传输的，因此在传输过程中也会被截获合成密钥，因此也是不安全的，于是迭代到了第二个版本**非对称加密版本**

### 2. 非对称加密版本
所谓非对称加密我们可以理解为，当我们使用A密钥加密时，解密只能使用B密钥。我们把服务方加密/解密的密钥称为**私钥**，客户端加密/解密的密钥称为公钥。

#### 加密过程
- 浏览器向服务器发送支持的加密方法
- 服务器会返回加密方法和客户端用来加密的公钥
- 浏览器和服务器互相返回确认信息

#### 非对称加密的缺点
- 非对称加密的效率较低，会影响页面的打开速度
- 中间人可以截获传输的公钥并传递非法数据，服务器无法确定数据的安全性

### 3. 非对称加密和对称加密混合版本
在传输数据阶段依然使用对称加密，但是对称加密的密钥我们采用非对称加密来传输。

#### 加密过程
- 浏览器向服务器发送支持的对称加密方法、非对称加密方法、生成的client-random
- 服务器接收并选择合适的加密方法返回service-random、公钥
- 浏览器生成pre-master随机数并使用公钥进行加密传给服务器，这一步也是避免中间人攻击的重要步骤
- 服务器私钥解密pre-master，两端根据client-random、service-random、pre-master生成master-secret密钥，对数据进行加密解密。

### 4. 数字证书版本
以上的版本迭代我们基本解决了中间人攻击的问题，但是依然还有一个问题存在，那就是黑客通过DNS攻击将我们访问的站点恶意修改为不安全的服务器ip，但是这在浏览器端我们无法判断访问的是黑客站点，因此我们需要服务器来证明“我就是我”，因此**CA(Certificate Authority)**机构出现了，颁发的证书称为**数字证书（Digital Certificate)**。

#### 加密过程
引入数字证书后，加密过程主要是在第一步客户端发送信息之后，服务端会将加密方法、service-random、公钥、**数字证书**，同时在客户端生成pre-master之前进行数字证书认证确认当前服务器是安全的。